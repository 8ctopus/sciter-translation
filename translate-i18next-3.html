<html>
<head>
<script type="module">

//import i18next from 'https://raw.githubusercontent.com/i18next/i18next/master/src/index.js';
import i18next from 'https://deno.land/x/i18next/index.js';

import * as sys from "@sys";
import {encode,decode} from "@sciter";

// get console from iframe parent
console = Window.this.document.globalThis.console;

var _init = false;

async function init()
{
    // load translations
    let buffer = sys.fs.$readfile("locales/en/translation.json");
    var en = JSON.parse(decode(buffer));

    buffer = sys.fs.$readfile("locales/fr/translation.json");
    var fr = JSON.parse(decode(buffer));

    buffer = sys.fs.$readfile("locales/de/translation.json");
    var de = JSON.parse(decode(buffer));

    // init translation system
    const promise = i18next
        .init({
            debug: true,

            lng: "de",

            // show en if translation is not available
            fallbackLng: "en",

            ns: ["translation"],
            defaultNS: "translation",

            resources: {
                en: en,
                fr: fr,
                de: de,
            },

            saveMissing: true,
        });

    try {
        // wait for promise
        const result = await promise;

        _init = true;

        console.log(`Init i18next - OK`);
    }
    catch (error) {
        console.log(`Init i18next - FAILED - ${error}`);
    }
}

function translate()
{
    // wait for i18next to be initialized
    while (!_init) {
        console.log(`Init i18next (2) - WAITING`);
        setTimeout(translate, 1);
        return;
    }

    console.log(`Init i18next (2) - OK`);

    document.$("p").innerText              = i18next.t("description");
    document.$("span#hello").innerText     = i18next.t("hello");
    document.$("span#howareyou").innerText = i18next.t("howareyou");
    document.$("button").innerText         = i18next.t("button");
}

document.on("ready", function() {
    init();
    translate();
});

</script>
</head>
<body>
    <p> Testing translation using i18next </p>
    <span #hello> hello </span>
    <span #howareyou> how are you today? </span>
    <button>change language</button>
</body>
</html>
